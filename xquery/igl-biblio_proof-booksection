(: XQuery nested inside HTML :)
(: declare namespace tei="http://www.tei-c.org/ns/1.0"; :)
<html>
<head>
<title>IGLouvre - Biblio - Contrôle qualité</title>
<style type="text/css"> 
<!-- 
  body { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; }
  table, th, td { border: 1px solid black; text-align:left;font-size :100%; }
  thead { font-weight:bold; }
  span.resp:nth-child(odd) { display:block; color:maroon; }
  span.resp:nth-child(even) { display:block; color:green; }
  span.role { font-size:75%; }
--> 
</style> 
</head>
<body>
<div class="conteneur">

<h1>IGLouvre - Bibliographie - Contrôle qualité</h1>
<h2>Monographies </h2>
<p>{current-date()}</p>
  <table>
    <thead>   
      <tr>       
        <td class="1">annee</td>
        <td class="2">titre</td>
        <td class="3">titre-short</td>
        <td class="4">extra</td>
        <td class="5">auteur</td>
        <td class="6">lien</td>
      </tr>
    </thead>
    <tbody>
{for $bibl in db:open('igl_bibliography_exemple')//biblStruct[@type='book']
let $id := $bibl/@id
let $monogr := $bibl/monogr[1]
let $titre := $monogr/title[@level="m"][not(@type='short')]/text()
let $titre-short := $monogr/title[@level="m"][@type='short']/text()
let $auteur := $monogr/author
let $editeur := $monogr/editor
let $annee := $monogr/imprint/date/@when
let $lien := $bibl/idno[@type='zotero-uri']/text()
let $extra := $bibl/monogr[2]
let $contributeur := $monogr/respStmt/contributor
let $test := $monogr/*[name()="author" or name()='editor' or  name()='respStmt']
let $espace := " "
order by $titre 

let $resp := for $i in $test
let $aut := $i/local-name()='author'


            
return 

<item org="{$i//name}" nom="{string($i//surname)}" prenom="{$i//forename}" role="{if ($aut) then ('auteur') else() }{$i/@role|$i/resp}"/>

(: bon :  {$i/@role|$i/resp} :)

return

<result>

     <tr>
        <td class="1">{string($annee)}</td>
        <td class="2">{$titre}</td>
        <td class="3">{$titre-short}</td>
        <td class="4">{$extra}</td>       
        <td class="5">
        {for $item in $resp
            return <span class="resp">
             
              {data($item/@org)}
               {data($item/@nom)}
                 {$espace}
                 {data($item/@prenom)}
                 {$espace}
                <span class="role">({data($item/@role)})</span>
               
            </span>
           }
        </td>
        <td class="6"><a href="{$lien}" title="{string($id)}" target='_blank'>vers Zotero</a></td>
      </tr>

  
</result>
}
    </tbody>
</table>

</div>
</body>
</html>